{% extends 'admin_templates/base_template.html' %}
{% block title %}
Product List
{% endblock title %}


{% block custom_css %}
<style>
    .copy-btn {
        margin-left: 5px;
    }
    .copied-message {
        color: green;
        font-size: 0.8em;
        margin-left: 10px;
        display: none;
    }
</style>
{% endblock custom_css %}

{% block page_title %}
Product List
{% endblock page_title %}

{% block page_content %}
<div class="row mb-3">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <p class="mb-0">
                    <strong>Total Products:</strong> {{ paginator.count }}
                    {% if filter or brand %}
                        <span class="text-muted">(filtered)</span>
                    {% endif %}
                </p>
                {% if page_obj %}
                    <p class="mb-0">
                        Showing {{ page_obj.start_index }} - {{ page_obj.end_index }} of {{ paginator.count }} products
                        {% if paginator.num_pages > 1 %}
                            (Page {{ page_obj.number }} of {{ paginator.num_pages }})
                        {% endif %}
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <div class="search-element">
        <div class="card">
                  <div class="card-body">
                  <form method="get" id="product-filter-form">
                    <a href="{% url 'product_list' %}?export=csv&filter={{ filter }}&brand={{ brand }}&orderby={{ orderby }}" class="btn btn-success" style="float:right; margin-left: 10px;"><i class="fas fa-file-export"></i> Export to CSV</a>
                    <button class="btn btn-primary" type="submit" style="float:right"><i class="fas fa-search"></i> Search</button>
                    <select
                        name="brand"
                        class="form-control"
                        style="width: 150px; float:right; margin-right: 10px;"
                        onchange="this.form.submit()"
                        aria-label="Select Brand"
                        data-placeholder="Filter by Brand"
                    >
                        <option value="" {% if not brand %}selected{% endif %}>All Brands</option>
                        {% for brand_option in brands %}
                            <option
                                value="{{ brand_option }}"
                                {% if brand == brand_option %}selected{% endif %}
                            >
                                {{ brand_option }}
                            </option>
                        {% endfor %}
                    </select>
                    <input
                        class="form-control"
                        type="search"
                        placeholder="Search"
                        aria-label="Search"
                        data-width="250"
                        style="width: 250px;float:right; margin-right: 10px;"
                        name="filter"
                        value="{{ filter }}"
                    >
                   </form>
                  </div>
                </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <table class="table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for product in page_obj %}
                <tr>
                    <td>
                        <span class="badge badge-warning">
                            Url Slug: {{ product.url_slug }}
                        </span>
                        <button
                            type="button"
                            class="btn btn-sm btn-secondary ml-2"
                            onclick="copyProductUrl('{{ request.scheme }}://{{ request.get_host }}{% url 'product_detail' slug=product.url_slug %}')"
                        >
                            Copy URL
                        </button>
                        <span id="copyMessage" class="copied-message" style="display:none;">Copied!</span>
                    </td>
                    <td>
                        <!-- Existing action buttons can remain here -->
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock page_content %}

{% block custom_js %}
<script>
function copyProductUrl(url) {
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(url).then(function () {
            const copyMessage = document.getElementById('copyMessage');
            copyMessage.style.display = 'inline';

            setTimeout(() => {
                copyMessage.style.display = 'none';
            }, 2000);
        });
    } else {
        const tempInput = document.createElement('input');
        tempInput.value = url;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);

        const copyMessage = document.getElementById('copyMessage');
        copyMessage.style.display = 'inline';

        setTimeout(() => {
            copyMessage.style.display = 'none';
        }, 2000);
    }
}
</script>
{% endblock custom_js %}